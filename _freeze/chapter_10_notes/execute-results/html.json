{
  "hash": "debb0b6882d23b05309c4f8c9f7c1cc9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R for Data Science, 2nd Edition - Chapter 10 Notes\"\nfreeze: true\nformat:\n    html:\n        toc: true\neditor_options: \n  chunk_output_type: console\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.6\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.2\n✔ purrr     1.2.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n:::\n\n\n\n# Exploratory data analysis\n\n## 10.2 Questions\n\n\nTwo types of questions are generally useful:\n\n1. What type of variation occurs within my variables?\n\n2. What type of covariation occurs between my variables?\n\n\n## 10.3 Variation\n\nBoth within and across units.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diamonds, aes(x = carat)) +\n  geom_histogram(binwidth = 0.5)\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nMore questions to ask:\n\n-   Which values are the most common? Why?\n\n-   Which values are rare? Why? Does that match your expectations?\n\n-   Can you see any unusual patterns? What might explain them?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsmaller <- diamonds |> \n  filter(carat < 3)\n\nggplot(smaller, aes(x = carat)) +\n  geom_histogram(binwidth = 0.01)\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nExamples of follow-up questions for this plot:\n\n-   Why are there more diamonds at whole carats and common fractions of carats?\n\n-   Why are there more diamonds slightly to the right of each peak than there are slightly to the left of each peak?\n\n\nData visualization can reveal clusters. To understand subgroups:\n\n-   How are the observations within each subgroup similar to each other?\n\n-   How are the observations in separate clusters different from each other?\n\n-   How can you explain or describe the clusters?\n\n-   Why might the appearance of clusters be misleading?\n\n\n## 10.4 Unusual values\n\n\nSometimes these are hard to see, but you can tell by the limits of the x-axis sometimes:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diamonds, aes(x = y)) + \n  geom_histogram(binwidth = 0.5)\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\nYou can zoom in on areas of your plot using `coord_cartesian`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diamonds, aes(x = y)) + \n  geom_histogram(binwidth = 0.5) +\n  coord_cartesian(ylim = c(0, 50))\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\nThree unusual values at about 0, 30, and 60\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunusual <- diamonds |> \n  filter(y < 3 | y > 20) |> \n  select(price, x, y, z) |>\n  arrange(y)\nunusual\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 9 × 4\n  price     x     y     z\n  <int> <dbl> <dbl> <dbl>\n1  5139  0      0    0   \n2  6381  0      0    0   \n3 12800  0      0    0   \n4 15686  0      0    0   \n5 18034  0      0    0   \n6  2130  0      0    0   \n7  2130  0      0    0   \n8  2075  5.15  31.8  5.12\n9 12210  8.09  58.9  8.06\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 9 × 4\n#>   price     x     y     z\n#>   <int> <dbl> <dbl> <dbl>\n#> 1  5139  0      0    0   \n#> 2  6381  0      0    0   \n#> 3 12800  0      0    0   \n#> 4 15686  0      0    0   \n#> 5 18034  0      0    0   \n#> 6  2130  0      0    0   \n#> 7  2130  0      0    0   \n#> 8  2075  5.15  31.8  5.12\n#> 9 12210  8.09  58.9  8.06\n```\n:::\n\n\n\nOne approach is to replace unusual values with `NA`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiamonds2 <- diamonds |> \n  mutate(y = if_else(y < 3 | y > 20, NA, y))\n```\n:::\n\n\n\nggplot excludes `NA` values:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diamonds2, aes(x = x, y = y)) + \n  geom_point()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 9 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#> Warning: Removed 9 rows containing missing values or values outside the scale range\n#> (`geom_point()`).\n```\n:::\n\n\nYou can suppress the missing warning like this:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diamonds2, aes(x = x, y = y)) + \n  geom_point(na.rm = TRUE)\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\nInvestigating missing values is also important. Understand the patterns of missingness. Here, missing values in the `dep_time` variable indicate that the flight was cancelled.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnycflights13::flights |> \n  mutate(\n    cancelled = is.na(dep_time),\n    sched_hour = sched_dep_time %/% 100,\n    sched_min = sched_dep_time %% 100,\n    sched_dep_time = sched_hour + (sched_min / 60)\n  ) |> \n  ggplot(aes(x = sched_dep_time)) + \n  geom_freqpoly(aes(color = cancelled), binwidth = 1/4)\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n## 10.5 Covariation\n\nWhen two variables vary together. Plot them.\n\n**A categorical and numerical**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diamonds, aes(x = price)) + \n  geom_freqpoly(aes(color = cut), binwidth = 500, linewidth = 0.75)\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nHard to compare because counts are so different. Use the **density**, which is the count standardized so that the area under each frequency polygon is one.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diamonds, aes(x = price, y = after_stat(density))) + \n  geom_freqpoly(aes(color = cut), binwidth = 500, linewidth = 0.75)\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\nDo fair cuts have the highest average price as indicated by the prior plot?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diamonds, aes(x = cut, y = price)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nWhy are better quality cuts cheaper?\n\n\nHow does highway mileage vary across classes?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = class, y = hwy)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nTemporarily reordering factors would make the trend easier to see:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = fct_reorder(class, hwy, median), y = hwy)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\nLong variable names look better if you flip the x and y aesthetic mappings:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = hwy, y = fct_reorder(class, hwy, median))) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n\n**Two categorical variables**.\n\nCount the cell values in the cross tabulation table and then plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diamonds, aes(x = cut, y = color)) +\n  geom_count()\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\nGenerate the counts\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiamonds |> \n  count(color, cut)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 35 × 3\n   color cut           n\n   <ord> <ord>     <int>\n 1 D     Fair        163\n 2 D     Good        662\n 3 D     Very Good  1513\n 4 D     Premium    1603\n 5 D     Ideal      2834\n 6 E     Fair        224\n 7 E     Good        933\n 8 E     Very Good  2400\n 9 E     Premium    2337\n10 E     Ideal      3903\n# ℹ 25 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 35 × 3\n#>   color cut           n\n#>   <ord> <ord>     <int>\n#> 1 D     Fair        163\n#> 2 D     Good        662\n#> 3 D     Very Good  1513\n#> 4 D     Premium    1603\n#> 5 D     Ideal      2834\n#> 6 E     Fair        224\n#> # ℹ 29 more rows\n```\n:::\n\n\n\nAnd then visualize with `geom_tile()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiamonds |> \n  count(color, cut) |>  \n  ggplot(aes(x = color, y = cut)) +\n  geom_tile(aes(fill = n))\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n\n\n**Two numerical variables**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(smaller, aes(x = carat, y = price)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\nOverplotting can be a problem. You can use `alpha`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(smaller, aes(x = carat, y = price)) + \n  geom_point(alpha = 1 / 100)\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n\nAnother solution to overplotting is binning. `geom_histogram()` and `geom_freqpoly()` bin in one dimension. Use `geom_bin2d()` and `geom_hex()` to bin in two dimensions. The difference is between rectangular bins and hexagonal bins. Install the `hexbin` package to use `geom_hex()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(smaller, aes(x = carat, y = price)) +\n  geom_bin2d()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`stat_bin2d()` using `bins = 30`. Pick better value `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#> `stat_bin2d()` using `bins = 30`. Pick better value `binwidth`.\n\n# install.packages(\"hexbin\")\nggplot(smaller, aes(x = carat, y = price)) +\n  geom_hex()\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-22-2.png){width=672}\n:::\n:::\n\n\n\nYou can also bin one numerical variable, so that you are plotting a categorical and numerical:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(smaller, aes(x = carat, y = price)) + \n  geom_boxplot(aes(group = cut_width(carat, 0.1)))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Orientation is not uniquely specified when both the x and y aesthetics are\ncontinuous. Picking default orientation 'x'.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#> Warning: Orientation is not uniquely specified when both the x and y aesthetics are\n#> continuous. Picking default orientation 'x'.\n```\n:::\n\n\n\nYou can make the width of boxplots proportional to number of observations with `varwidth = TRUE`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(smaller, aes(x = carat, y = price)) + \n  geom_boxplot(aes(group = cut_width(carat, 0.1)), varwidth = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Orientation is not uniquely specified when both the x and y aesthetics are\ncontinuous. Picking default orientation 'x'.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n\n\n## 10.6 Patterns and models\n\nMore questions to ask:\n\n-   Could this pattern be due to coincidence (i.e. random chance)?\n\n-   How can you describe the relationship implied by the pattern?\n\n-   How strong is the relationship implied by the pattern?\n\n-   What other variables might affect the relationship?\n\n-   Does the relationship change if you look at individual subgroups of the data?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidymodels)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching packages ────────────────────────────────────── tidymodels 1.4.1 ──\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n✔ broom        1.0.12     ✔ rsample      1.3.2 \n✔ dials        1.4.2      ✔ tailor       0.1.0 \n✔ infer        1.1.0      ✔ tune         2.0.1 \n✔ modeldata    1.5.1      ✔ workflows    1.3.0 \n✔ parsnip      1.4.1      ✔ workflowsets 1.1.1 \n✔ recipes      1.3.1      ✔ yardstick    1.3.2 \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──\n✖ scales::discard() masks purrr::discard()\n✖ dplyr::filter()   masks stats::filter()\n✖ recipes::fixed()  masks stringr::fixed()\n✖ dplyr::lag()      masks stats::lag()\n✖ yardstick::spec() masks readr::spec()\n✖ recipes::step()   masks stats::step()\n```\n\n\n:::\n\n```{.r .cell-code}\ndiamonds <- diamonds |>\n  mutate(\n    log_price = log(price),\n    log_carat = log(carat)\n  )\n\ndiamonds_fit <- linear_reg() |>\n  fit(log_price ~ log_carat, data = diamonds)\n\ndiamonds_aug <- augment(diamonds_fit, new_data = diamonds) |>\n  mutate(.resid = exp(.resid))\n\nggplot(diamonds_aug, aes(x = carat, y = .resid)) + \n  geom_point()\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n\nNow you can see the relationship between cut and price: better quality diamonds are more expensive relative to size.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diamonds_aug, aes(x = cut, y = .resid)) + \n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](chapter_10_notes_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\n",
    "supporting": [
      "chapter_10_notes_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}