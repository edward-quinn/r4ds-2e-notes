{
  "hash": "7d93625ace3b30719a7aad2fa20edc19",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R for Data Science, 2nd Edition - Chapter 17 Notes\"\nfreeze: true\nformat:\n    html:\n        toc: true\n        toc-title: Contents\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n# 17 Dates and times\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.6\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.2\n✔ purrr     1.2.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(nycflights13)\n```\n:::\n\n\n\n## 17.2 Creating date/times\n\nThere are three types of date/time data: `date`, `time`, `date-time`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncsv <- \"\n  date,datetime\n  2022-01-02,2022-01-02 05:12\n\"\nread_csv(csv)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `file` argument of `vroom()` must use `I()` for literal data as of vroom\n1.5.0.\n  \n  # Bad:\n  vroom(\"X,Y\\n1.5,2.3\\n\")\n  \n  # Good:\n  vroom(I(\"X,Y\\n1.5,2.3\\n\"))\nℹ The deprecated feature was likely used in the readr package.\n  Please report the issue at <https://github.com/tidyverse/readr/issues>.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 1 Columns: 2\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\ndttm (1): datetime\ndate (1): date\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  date       datetime           \n  <date>     <dttm>             \n1 2022-01-02 2022-01-02 05:12:00\n```\n\n\n:::\n\n```{.r .cell-code}\n#> Warning: The `file` argument of `vroom()` must use `I()` for literal data as of vroom\n#> 1.5.0.\n#>   \n#>   # Bad:\n#>   vroom(\"X,Y\\n1.5,2.3\\n\")\n#>   \n#>   # Good:\n#>   vroom(I(\"X,Y\\n1.5,2.3\\n\"))\n#> ℹ The deprecated feature was likely used in the readr package.\n#>   Please report the issue at <https://github.com/tidyverse/readr/issues>.\n#> # A tibble: 1 × 2\n#>   date       datetime           \n#>   <date>     <dttm>             \n#> 1 2022-01-02 2022-01-02 05:12:00\n```\n:::\n\n\nA few options for an ambigous date:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncsv <- \"\n  date\n  01/02/15\n\"\n\nread_csv(csv, col_types = cols(date = col_date(\"%m/%d/%y\")))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  date      \n  <date>    \n1 2015-01-02\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 1 × 1\n#>   date      \n#>   <date>    \n#> 1 2015-01-02\n\nread_csv(csv, col_types = cols(date = col_date(\"%d/%m/%y\")))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  date      \n  <date>    \n1 2015-02-01\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 1 × 1\n#>   date      \n#>   <date>    \n#> 1 2015-02-01\n\nread_csv(csv, col_types = cols(date = col_date(\"%y/%m/%d\")))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  date      \n  <date>    \n1 2001-02-15\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 1 × 1\n#>   date      \n#>   <date>    \n#> 1 2001-02-15\n```\n:::\n\n\nYou can also parse dates from strings using the `ymd`, `mdy`, and `dmy` functions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nymd(\"2017-01-31\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2017-01-31\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2017-01-31\"\nmdy(\"January 31st, 2017\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2017-01-31\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2017-01-31\"\ndmy(\"31-Jan-2017\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2017-01-31\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2017-01-31\"\n```\n:::\n\n\n\nTo create date-times, just add an underscore and then one or more of \"h\", \"m\", or \"s\".\n\n\n::: {.cell}\n\n```{.r .cell-code}\nymd_hms(\"2017-01-31 20:11:59\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2017-01-31 20:11:59 UTC\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2017-01-31 20:11:59 UTC\"\nmdy_hm(\"01/31/2017 08:01\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2017-01-31 08:01:00 UTC\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2017-01-31 08:01:00 UTC\"\n```\n:::\n\n\nSometimes date components are spread across columns:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights |> \n  select(year, month, day, hour, minute)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 336,776 × 5\n    year month   day  hour minute\n   <int> <int> <int> <dbl>  <dbl>\n 1  2013     1     1     5     15\n 2  2013     1     1     5     29\n 3  2013     1     1     5     40\n 4  2013     1     1     5     45\n 5  2013     1     1     6      0\n 6  2013     1     1     5     58\n 7  2013     1     1     6      0\n 8  2013     1     1     6      0\n 9  2013     1     1     6      0\n10  2013     1     1     6      0\n# ℹ 336,766 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 336,776 × 5\n#>    year month   day  hour minute\n#>   <int> <int> <int> <dbl>  <dbl>\n#> 1  2013     1     1     5     15\n#> 2  2013     1     1     5     29\n#> 3  2013     1     1     5     40\n#> 4  2013     1     1     5     45\n#> 5  2013     1     1     6      0\n#> 6  2013     1     1     5     58\n#> # ℹ 336,770 more rows\n```\n:::\n\n\nThe `make_dates()` function is useful here:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights |> \n  select(year, month, day, hour, minute) |> \n  mutate(departure = make_datetime(year, month, day, hour, minute))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 336,776 × 6\n    year month   day  hour minute departure          \n   <int> <int> <int> <dbl>  <dbl> <dttm>             \n 1  2013     1     1     5     15 2013-01-01 05:15:00\n 2  2013     1     1     5     29 2013-01-01 05:29:00\n 3  2013     1     1     5     40 2013-01-01 05:40:00\n 4  2013     1     1     5     45 2013-01-01 05:45:00\n 5  2013     1     1     6      0 2013-01-01 06:00:00\n 6  2013     1     1     5     58 2013-01-01 05:58:00\n 7  2013     1     1     6      0 2013-01-01 06:00:00\n 8  2013     1     1     6      0 2013-01-01 06:00:00\n 9  2013     1     1     6      0 2013-01-01 06:00:00\n10  2013     1     1     6      0 2013-01-01 06:00:00\n# ℹ 336,766 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 336,776 × 6\n#>    year month   day  hour minute departure          \n#>   <int> <int> <int> <dbl>  <dbl> <dttm>             \n#> 1  2013     1     1     5     15 2013-01-01 05:15:00\n#> 2  2013     1     1     5     29 2013-01-01 05:29:00\n#> 3  2013     1     1     5     40 2013-01-01 05:40:00\n#> 4  2013     1     1     5     45 2013-01-01 05:45:00\n#> 5  2013     1     1     6      0 2013-01-01 06:00:00\n#> 6  2013     1     1     5     58 2013-01-01 05:58:00\n#> # ℹ 336,770 more rows\n```\n:::\n\n\n\nUse modulus arithmetic to pull out hour and minute components.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmake_datetime_100 <- function(year, month, day, time) {\n  make_datetime(year, month, day, time %/% 100, time %% 100)\n}\n\nflights_dt <- flights |> \n  filter(!is.na(dep_time), !is.na(arr_time)) |> \n  mutate(\n    dep_time = make_datetime_100(year, month, day, dep_time),\n    arr_time = make_datetime_100(year, month, day, arr_time),\n    sched_dep_time = make_datetime_100(year, month, day, sched_dep_time),\n    sched_arr_time = make_datetime_100(year, month, day, sched_arr_time)\n  ) |> \n  select(origin, dest, ends_with(\"delay\"), ends_with(\"time\"))\n\nflights_dt\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 328,063 × 9\n   origin dest  dep_delay arr_delay dep_time            sched_dep_time     \n   <chr>  <chr>     <dbl>     <dbl> <dttm>              <dttm>             \n 1 EWR    IAH           2        11 2013-01-01 05:17:00 2013-01-01 05:15:00\n 2 LGA    IAH           4        20 2013-01-01 05:33:00 2013-01-01 05:29:00\n 3 JFK    MIA           2        33 2013-01-01 05:42:00 2013-01-01 05:40:00\n 4 JFK    BQN          -1       -18 2013-01-01 05:44:00 2013-01-01 05:45:00\n 5 LGA    ATL          -6       -25 2013-01-01 05:54:00 2013-01-01 06:00:00\n 6 EWR    ORD          -4        12 2013-01-01 05:54:00 2013-01-01 05:58:00\n 7 EWR    FLL          -5        19 2013-01-01 05:55:00 2013-01-01 06:00:00\n 8 LGA    IAD          -3       -14 2013-01-01 05:57:00 2013-01-01 06:00:00\n 9 JFK    MCO          -3        -8 2013-01-01 05:57:00 2013-01-01 06:00:00\n10 LGA    ORD          -2         8 2013-01-01 05:58:00 2013-01-01 06:00:00\n# ℹ 328,053 more rows\n# ℹ 3 more variables: arr_time <dttm>, sched_arr_time <dttm>, air_time <dbl>\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 328,063 × 9\n#>   origin dest  dep_delay arr_delay dep_time            sched_dep_time     \n#>   <chr>  <chr>     <dbl>     <dbl> <dttm>              <dttm>             \n#> 1 EWR    IAH           2        11 2013-01-01 05:17:00 2013-01-01 05:15:00\n#> 2 LGA    IAH           4        20 2013-01-01 05:33:00 2013-01-01 05:29:00\n#> 3 JFK    MIA           2        33 2013-01-01 05:42:00 2013-01-01 05:40:00\n#> 4 JFK    BQN          -1       -18 2013-01-01 05:44:00 2013-01-01 05:45:00\n#> 5 LGA    ATL          -6       -25 2013-01-01 05:54:00 2013-01-01 06:00:00\n#> 6 EWR    ORD          -4        12 2013-01-01 05:54:00 2013-01-01 05:58:00\n#> # ℹ 328,057 more rows\n#> # ℹ 3 more variables: arr_time <dttm>, sched_arr_time <dttm>, …\n```\n:::\n\n\n\nVisualize departure time across the year\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights_dt |> \n  ggplot(aes(x = dep_time)) + \n  geom_freqpoly(binwidth = 86400) # 86400 seconds = 1 day\n```\n\n::: {.cell-output-display}\n![](chapter_17_notes_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nor a single day\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights_dt |> \n  filter(dep_time < ymd(20130102)) |> \n  ggplot(aes(x = dep_time)) + \n  geom_freqpoly(binwidth = 600) # 600 s = 10 minutes\n```\n\n::: {.cell-output-display}\n![](chapter_17_notes_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nas_datetime(today())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2026-02-07 UTC\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2026-02-05 UTC\"\nas_date(now())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2026-02-07\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2026-02-05\"\n```\n:::\n\n\n\nParse the following with a readr column specification and a lubridate function.\nThis is a good exercise.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd1 <- \"January 1, 2010\"\nd2 <- \"2015-Mar-07\"\nd3 <- \"06-Jun-2017\"\nd4 <- c(\"August 19 (2015)\", \"July 1 (2015)\")\nd5 <- \"12/30/14\" # Dec 30, 2014\nt1 <- \"1705\"\nt2 <- \"11:15:10.12 PM\"\n```\n:::\n\n\n\n## 17.3 Date-time components\n\nYou can pull out individual parts of the date with the accessor functions year(), month(), mday() (day of the month), yday() (day of the year), wday() (day of the week), hour(), minute(), and second(). These are effectively the opposites of make_datetime().\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatetime <- ymd_hms(\"2026-07-08 12:34:56\")\n\nyear(datetime)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2026\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] 2026\nmonth(datetime)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 7\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] 7\nmday(datetime)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 8\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] 8\n\nyday(datetime)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 189\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] 189\nwday(datetime)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] 4\n```\n:::\n\n\nFor month() and wday() you can set label = TRUE to return the abbreviated name of the month or day of the week. Set abbr = FALSE to return the full name.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights_dt |> \n  mutate(wday = wday(dep_time, label = TRUE)) |> \n  ggplot(aes(x = wday)) +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](chapter_17_notes_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights_dt |> \n  mutate(minute = minute(dep_time)) |> \n  group_by(minute) |> \n  summarize(\n    avg_delay = mean(dep_delay, na.rm = TRUE),\n    n = n()\n  ) |> \n  ggplot(aes(x = minute, y = avg_delay)) +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![](chapter_17_notes_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\ncontrast with scheduled departure time\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsched_dep <- flights_dt |> \n  mutate(minute = minute(sched_dep_time)) |> \n  group_by(minute) |> \n  summarize(\n    avg_delay = mean(arr_delay, na.rm = TRUE),\n    n = n()\n  )\n\nggplot(sched_dep, aes(x = minute, y = avg_delay)) +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![](chapter_17_notes_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n**Rounding** dates with `floor_date()`, `round_date()`, and `ceiling_date()`.\n\nAn example of plotting the number of flights per week.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights_dt |> \n  count(week = floor_date(dep_time, \"week\")) |> \n  ggplot(aes(x = week, y = n)) +\n  geom_line() + \n  geom_point()\n```\n\n::: {.cell-output-display}\n![](chapter_17_notes_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nShow distribution of flights across the day:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights_dt |> \n  mutate(dep_hour = dep_time - floor_date(dep_time, \"day\")) |> \n  ggplot(aes(x = dep_hour)) +\n  geom_freqpoly(binwidth = 60 * 30)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nDon't know how to automatically pick scale for object of type <difftime>.\nDefaulting to continuous.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_17_notes_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#> Don't know how to automatically pick scale for object of type <difftime>.\n#> Defaulting to continuous.\n```\n:::\n\n\n\n\n**Modifying components**. You can modify components of a date/time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(datetime <- ymd_hms(\"2026-07-08 12:34:56\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2026-07-08 12:34:56 UTC\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2026-07-08 12:34:56 UTC\"\n\nyear(datetime) <- 2030\ndatetime\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2030-07-08 12:34:56 UTC\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2030-07-08 12:34:56 UTC\"\nmonth(datetime) <- 01\ndatetime\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2030-01-08 12:34:56 UTC\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2030-01-08 12:34:56 UTC\"\nhour(datetime) <- hour(datetime) + 1\ndatetime\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2030-01-08 13:34:56 UTC\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2030-01-08 13:34:56 UTC\"\n```\n:::\n\n\nYou can modify multiple components at once:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nupdate(datetime, year = 2030, month = 2, mday = 2, hour = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2030-02-02 02:34:56 UTC\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2030-02-02 02:34:56 UTC\"\n#> \n\nupdate(ymd(\"2023-02-01\"), mday = 30)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2023-03-02\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2023-03-02\"\nupdate(ymd(\"2023-02-01\"), hour = 400)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2023-02-17 16:00:00 UTC\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2023-02-17 16:00:00 UTC\"\n```\n:::\n\n\n## 17.4 Time spans\n\n**Durations**, which represent an exact number of seconds.\n**Periods**, which represent human units like weeks and months.\n**Intervals**, which represent a starting and ending point.\n\nHow do you pick between duration, periods, and intervals? As always, pick the simplest data structure that solves your problem. If you only care about physical time, use a duration; if you need to add human times, use a period; if you need to figure out how long a span is in human units, use an interval.\n\n**Durations**. Subtracting two times gives you a difftime object:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# How old is Edward?\nh_age <- today() - ymd(\"1989-04-16\")\nh_age\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTime difference of 13446 days\n```\n\n\n:::\n\n```{.r .cell-code}\n#> Time difference of 16916 days\n```\n:::\n\n\ndifftimes can be hard to work with, so it can be useful to convert to a form that always uses seconds: the **duration**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nas.duration(h_age)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"1161734400s (~36.81 years)\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"1461542400s (~46.31 years)\"\n```\n:::\n\n\ndurations come with convenient constructors:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndseconds(15)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"15s\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"15s\"\ndminutes(10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"600s (~10 minutes)\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"600s (~10 minutes)\"\ndhours(c(12, 24))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"43200s (~12 hours)\" \"86400s (~1 days)\"  \n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"43200s (~12 hours)\" \"86400s (~1 days)\"\nddays(0:5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"0s\"                \"86400s (~1 days)\"  \"172800s (~2 days)\"\n[4] \"259200s (~3 days)\" \"345600s (~4 days)\" \"432000s (~5 days)\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"0s\"                \"86400s (~1 days)\"  \"172800s (~2 days)\"\n#> [4] \"259200s (~3 days)\" \"345600s (~4 days)\" \"432000s (~5 days)\"\ndweeks(3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"1814400s (~3 weeks)\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"1814400s (~3 weeks)\"\ndyears(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"31557600s (~1 years)\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"31557600s (~1 years)\"\n```\n:::\n\n\nYou can add and multiply durations:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n2 * dyears(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"63115200s (~2 years)\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"63115200s (~2 years)\"\ndyears(1) + dweeks(12) + dhours(15)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"38869200s (~1.23 years)\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"38869200s (~1.23 years)\"\n```\n:::\n\n\n\nSometimes with durations you get unexpected results because of things like daylight savings time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\none_am <- ymd_hms(\"2026-03-08 01:00:00\", tz = \"America/New_York\")\n\none_am\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2026-03-08 01:00:00 EST\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2026-03-08 01:00:00 EST\"\none_am + ddays(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2026-03-09 02:00:00 EDT\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2026-03-09 02:00:00 EDT\"\n```\n:::\n\n\n\n\n**Periods** solve this for you. These work like human times. They don't have a fixed length in seconds.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\none_am\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2026-03-08 01:00:00 EST\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2026-03-08 01:00:00 EST\"\none_am + days(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2026-03-09 01:00:00 EDT\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2026-03-09 01:00:00 EDT\"\n```\n:::\n\n\nperiods can be constructed with a number of helper functions:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhours(c(12, 24))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"12H 0M 0S\" \"24H 0M 0S\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"12H 0M 0S\" \"24H 0M 0S\"\ndays(7)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"7d 0H 0M 0S\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"7d 0H 0M 0S\"\nmonths(1:6)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"1m 0d 0H 0M 0S\" \"2m 0d 0H 0M 0S\" \"3m 0d 0H 0M 0S\" \"4m 0d 0H 0M 0S\"\n[5] \"5m 0d 0H 0M 0S\" \"6m 0d 0H 0M 0S\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"1m 0d 0H 0M 0S\" \"2m 0d 0H 0M 0S\" \"3m 0d 0H 0M 0S\" \"4m 0d 0H 0M 0S\"\n#> [5] \"5m 0d 0H 0M 0S\" \"6m 0d 0H 0M 0S\"\n```\n:::\n\n\nYou can add and multiply periods\n\n\n::: {.cell}\n\n```{.r .cell-code}\n10 * (months(6) + days(1))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"60m 10d 0H 0M 0S\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"60m 10d 0H 0M 0S\"\ndays(50) + hours(25) + minutes(2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"50d 25H 2M 0S\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"50d 25H 2M 0S\"\n```\n:::\n\n\nAnd add them to dates\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# A leap year\nymd(\"2024-01-01\") + dyears(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2024-12-31 06:00:00 UTC\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2024-12-31 06:00:00 UTC\"\nymd(\"2024-01-01\") + years(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2025-01-01\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2025-01-01\"\n\n# Daylight saving time\none_am + ddays(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2026-03-09 02:00:00 EDT\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2026-03-09 02:00:00 EDT\"\none_am + days(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2026-03-09 01:00:00 EDT\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2026-03-09 01:00:00 EDT\"\n```\n:::\n\n\nUsing periods to fix erroneous data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights_dt |> \n  filter(arr_time < dep_time) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10,633 × 9\n   origin dest  dep_delay arr_delay dep_time            sched_dep_time     \n   <chr>  <chr>     <dbl>     <dbl> <dttm>              <dttm>             \n 1 EWR    BQN           9        -4 2013-01-01 19:29:00 2013-01-01 19:20:00\n 2 JFK    DFW          59        NA 2013-01-01 19:39:00 2013-01-01 18:40:00\n 3 EWR    TPA          -2         9 2013-01-01 20:58:00 2013-01-01 21:00:00\n 4 EWR    SJU          -6       -12 2013-01-01 21:02:00 2013-01-01 21:08:00\n 5 EWR    SFO          11       -14 2013-01-01 21:08:00 2013-01-01 20:57:00\n 6 LGA    FLL         -10        -2 2013-01-01 21:20:00 2013-01-01 21:30:00\n 7 EWR    MCO          41        43 2013-01-01 21:21:00 2013-01-01 20:40:00\n 8 JFK    LAX          -7       -24 2013-01-01 21:28:00 2013-01-01 21:35:00\n 9 EWR    FLL          49        28 2013-01-01 21:34:00 2013-01-01 20:45:00\n10 EWR    FLL          -9       -14 2013-01-01 21:36:00 2013-01-01 21:45:00\n# ℹ 10,623 more rows\n# ℹ 3 more variables: arr_time <dttm>, sched_arr_time <dttm>, air_time <dbl>\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 10,633 × 9\n#>   origin dest  dep_delay arr_delay dep_time            sched_dep_time     \n#>   <chr>  <chr>     <dbl>     <dbl> <dttm>              <dttm>             \n#> 1 EWR    BQN           9        -4 2013-01-01 19:29:00 2013-01-01 19:20:00\n#> 2 JFK    DFW          59        NA 2013-01-01 19:39:00 2013-01-01 18:40:00\n#> 3 EWR    TPA          -2         9 2013-01-01 20:58:00 2013-01-01 21:00:00\n#> 4 EWR    SJU          -6       -12 2013-01-01 21:02:00 2013-01-01 21:08:00\n#> 5 EWR    SFO          11       -14 2013-01-01 21:08:00 2013-01-01 20:57:00\n#> 6 LGA    FLL         -10        -2 2013-01-01 21:20:00 2013-01-01 21:30:00\n#> # ℹ 10,627 more rows\n#> # ℹ 3 more variables: arr_time <dttm>, sched_arr_time <dttm>, …\n```\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights_dt <- flights_dt |> \n  mutate(\n    overnight = arr_time < dep_time,\n    arr_time = arr_time + days(overnight),\n    sched_arr_time = sched_arr_time + days(overnight)\n  )\n```\n:::\n\n\n**Intervals**. lubridate estimates some calculations like this:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyears(1) / days(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 365.25\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] 365.25\n```\n:::\n\n\nAn **interval** is a pair of starting and ending date times, or you can think of it as a duration with a starting point.\n\nCreate an interval by writing `start %--% end`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ny2023 <- ymd(\"2023-01-01\") %--% ymd(\"2024-01-01\")\ny2024 <- ymd(\"2024-01-01\") %--% ymd(\"2025-01-01\")\n\ny2023\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2023-01-01 UTC--2024-01-01 UTC\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] 2023-01-01 UTC--2024-01-01 UTC\ny2024\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2024-01-01 UTC--2025-01-01 UTC\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] 2024-01-01 UTC--2025-01-01 UTC\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ny2023 / days(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 365\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] 365\ny2024 / days(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 366\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] 366\n```\n:::\n\n\n## 17.5 Timezones\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx1 <- ymd_hms(\"2024-06-01 12:00:00\", tz = \"America/New_York\")\nx1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2024-06-01 12:00:00 EDT\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2024-06-01 12:00:00 EDT\"\n\nx2 <- ymd_hms(\"2024-06-01 18:00:00\", tz = \"Europe/Copenhagen\")\nx2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2024-06-01 18:00:00 CEST\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2024-06-01 18:00:00 CEST\"\n\nx3 <- ymd_hms(\"2024-06-02 04:00:00\", tz = \"Pacific/Auckland\")\nx3\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2024-06-02 04:00:00 NZST\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2024-06-02 04:00:00 NZST\"\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx1 - x2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTime difference of 0 secs\n```\n\n\n:::\n\n```{.r .cell-code}\n#> Time difference of 0 secs\nx1 - x3\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTime difference of 0 secs\n```\n\n\n:::\n\n```{.r .cell-code}\n#> Time difference of 0 secs\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx4 <- c(x1, x2, x3)\nx4\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2024-06-01 12:00:00 EDT\" \"2024-06-01 12:00:00 EDT\"\n[3] \"2024-06-01 12:00:00 EDT\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2024-06-01 12:00:00 EDT\" \"2024-06-01 12:00:00 EDT\"\n#> [3] \"2024-06-01 12:00:00 EDT\"\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx4b <- force_tz(x4, tzone = \"Australia/Lord_Howe\")\nx4b\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2024-06-01 12:00:00 +1030\" \"2024-06-01 12:00:00 +1030\"\n[3] \"2024-06-01 12:00:00 +1030\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] \"2024-06-01 12:00:00 +1030\" \"2024-06-01 12:00:00 +1030\"\n#> [3] \"2024-06-01 12:00:00 +1030\"\nx4b - x4\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTime differences in hours\n[1] -14.5 -14.5 -14.5\n```\n\n\n:::\n\n```{.r .cell-code}\n#> Time differences in hours\n#> [1] -14.5 -14.5 -14.5\n```\n:::\n\n\n\n\n\n\n\n",
    "supporting": [
      "chapter_17_notes_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}