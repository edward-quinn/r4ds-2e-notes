{
  "hash": "f507d7a872d6c9ec47d25346b7ed34c7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R for Data Science, 2nd Edition - Chapter 5 Notes\"\nfreeze: true\nformat:\n    html:\n        toc: true\neditor_options: \n  chunk_output_type: console\n---\n\n# 5 Data tidying\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.6\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.2\n✔ purrr     1.2.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n:::\n\n\n## 5.3 Lengthening data\n\nUse `pivot_longer()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbillboard |> \n  pivot_longer(\n    cols = starts_with(\"wk\"), \n    names_to = \"week\", \n    values_to = \"rank\"\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 24,092 × 5\n   artist track                   date.entered week   rank\n   <chr>  <chr>                   <date>       <chr> <dbl>\n 1 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk1      87\n 2 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk2      82\n 3 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk3      72\n 4 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk4      77\n 5 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk5      87\n 6 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk6      94\n 7 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk7      99\n 8 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk8      NA\n 9 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk9      NA\n10 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk10     NA\n# ℹ 24,082 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 24,092 × 5\n#>    artist track                   date.entered week   rank\n#>    <chr>  <chr>                   <date>       <chr> <dbl>\n#>  1 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk1      87\n#>  2 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk2      82\n#>  3 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk3      72\n#>  4 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk4      77\n#>  5 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk5      87\n#>  6 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk6      94\n#>  7 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk7      99\n#>  8 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk8      NA\n#>  9 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk9      NA\n#> 10 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk10     NA\n#> # ℹ 24,082 more rows\n```\n:::\n\n\n- `cols` specifies which columns need to be pivoted, i.e. which columns aren’t variables. This argument uses the same syntax as `select()` so here we could use `!c(artist, track, date.entered)` or `starts_with(\"wk\")`.\n- `names_to` names the variable stored in the column names, we named that variable `week.`\n- `values_to` names the variable stored in the cell values, we named that variable `rank.`\n\nSo `pivot_longer()` starts with identifying which columns are variables, and which are not. For those columns that are not variables, we create a single variable capturing the names of these non-variable columns, and another variable capturing the values in the cells of those non-variable columns, which we must also name.\n\nSome `NA` values may be generated by the structure of the data set. This can be avoided with `values_drop_na = TRUE`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbillboard |> \n  pivot_longer(\n    cols = starts_with(\"wk\"), \n    names_to = \"week\", \n    values_to = \"rank\",\n    values_drop_na = TRUE\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5,307 × 5\n   artist  track                   date.entered week   rank\n   <chr>   <chr>                   <date>       <chr> <dbl>\n 1 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk1      87\n 2 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk2      82\n 3 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk3      72\n 4 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk4      77\n 5 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk5      87\n 6 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk6      94\n 7 2 Pac   Baby Don't Cry (Keep... 2000-02-26   wk7      99\n 8 2Ge+her The Hardest Part Of ... 2000-09-02   wk1      91\n 9 2Ge+her The Hardest Part Of ... 2000-09-02   wk2      87\n10 2Ge+her The Hardest Part Of ... 2000-09-02   wk3      92\n# ℹ 5,297 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 5,307 × 5\n#>   artist track                   date.entered week   rank\n#>   <chr>  <chr>                   <date>       <chr> <dbl>\n#> 1 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk1      87\n#> 2 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk2      82\n#> 3 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk3      72\n#> 4 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk4      77\n#> 5 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk5      87\n#> 6 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk6      94\n#> # ℹ 5,301 more rows\n```\n:::\n\n\n\nThe values for `week` are characters. This is a good opportunity to use `parse_number()`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbillboard_longer <- billboard |> \n  pivot_longer(\n    cols = starts_with(\"wk\"), \n    names_to = \"week\", \n    values_to = \"rank\",\n    values_drop_na = TRUE\n  ) |> \n  mutate(\n    week = parse_number(week)\n  )\nbillboard_longer\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5,307 × 5\n   artist  track                   date.entered  week  rank\n   <chr>   <chr>                   <date>       <dbl> <dbl>\n 1 2 Pac   Baby Don't Cry (Keep... 2000-02-26       1    87\n 2 2 Pac   Baby Don't Cry (Keep... 2000-02-26       2    82\n 3 2 Pac   Baby Don't Cry (Keep... 2000-02-26       3    72\n 4 2 Pac   Baby Don't Cry (Keep... 2000-02-26       4    77\n 5 2 Pac   Baby Don't Cry (Keep... 2000-02-26       5    87\n 6 2 Pac   Baby Don't Cry (Keep... 2000-02-26       6    94\n 7 2 Pac   Baby Don't Cry (Keep... 2000-02-26       7    99\n 8 2Ge+her The Hardest Part Of ... 2000-09-02       1    91\n 9 2Ge+her The Hardest Part Of ... 2000-09-02       2    87\n10 2Ge+her The Hardest Part Of ... 2000-09-02       3    92\n# ℹ 5,297 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 5,307 × 5\n#>   artist track                   date.entered  week  rank\n#>   <chr>  <chr>                   <date>       <dbl> <dbl>\n#> 1 2 Pac  Baby Don't Cry (Keep... 2000-02-26       1    87\n#> 2 2 Pac  Baby Don't Cry (Keep... 2000-02-26       2    82\n#> 3 2 Pac  Baby Don't Cry (Keep... 2000-02-26       3    72\n#> 4 2 Pac  Baby Don't Cry (Keep... 2000-02-26       4    77\n#> 5 2 Pac  Baby Don't Cry (Keep... 2000-02-26       5    87\n#> 6 2 Pac  Baby Don't Cry (Keep... 2000-02-26       6    94\n#> # ℹ 5,301 more rows\n```\n:::\n\n\n\nExamining `pivot_longer()`\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- tribble(\n  ~id,  ~bp1, ~bp2,\n   \"A\",  100,  120,\n   \"B\",  140,  115,\n   \"C\",  120,  125\n)\n\ndf |> \n  pivot_longer(\n    cols = bp1:bp2,\n    names_to = \"measurement\",\n    values_to = \"value\"\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  id    measurement value\n  <chr> <chr>       <dbl>\n1 A     bp1           100\n2 A     bp2           120\n3 B     bp1           140\n4 B     bp2           115\n5 C     bp1           120\n6 C     bp2           125\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 6 × 3\n#>   id    measurement value\n#>   <chr> <chr>       <dbl>\n#> 1 A     bp1           100\n#> 2 A     bp2           120\n#> 3 B     bp1           140\n#> 4 B     bp2           115\n#> 5 C     bp1           120\n#> 6 C     bp2           125\n```\n:::\n\n\nWhat if column names contain multiple pieces of information?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwho2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7,240 × 58\n   country      year sp_m_014 sp_m_1524 sp_m_2534 sp_m_3544 sp_m_4554 sp_m_5564\n   <chr>       <dbl>    <dbl>     <dbl>     <dbl>     <dbl>     <dbl>     <dbl>\n 1 Afghanistan  1980       NA        NA        NA        NA        NA        NA\n 2 Afghanistan  1981       NA        NA        NA        NA        NA        NA\n 3 Afghanistan  1982       NA        NA        NA        NA        NA        NA\n 4 Afghanistan  1983       NA        NA        NA        NA        NA        NA\n 5 Afghanistan  1984       NA        NA        NA        NA        NA        NA\n 6 Afghanistan  1985       NA        NA        NA        NA        NA        NA\n 7 Afghanistan  1986       NA        NA        NA        NA        NA        NA\n 8 Afghanistan  1987       NA        NA        NA        NA        NA        NA\n 9 Afghanistan  1988       NA        NA        NA        NA        NA        NA\n10 Afghanistan  1989       NA        NA        NA        NA        NA        NA\n# ℹ 7,230 more rows\n# ℹ 50 more variables: sp_m_65 <dbl>, sp_f_014 <dbl>, sp_f_1524 <dbl>,\n#   sp_f_2534 <dbl>, sp_f_3544 <dbl>, sp_f_4554 <dbl>, sp_f_5564 <dbl>,\n#   sp_f_65 <dbl>, sn_m_014 <dbl>, sn_m_1524 <dbl>, sn_m_2534 <dbl>,\n#   sn_m_3544 <dbl>, sn_m_4554 <dbl>, sn_m_5564 <dbl>, sn_m_65 <dbl>,\n#   sn_f_014 <dbl>, sn_f_1524 <dbl>, sn_f_2534 <dbl>, sn_f_3544 <dbl>,\n#   sn_f_4554 <dbl>, sn_f_5564 <dbl>, sn_f_65 <dbl>, ep_m_014 <dbl>, …\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 7,240 × 58\n#>   country      year sp_m_014 sp_m_1524 sp_m_2534 sp_m_3544 sp_m_4554\n#>   <chr>       <dbl>    <dbl>     <dbl>     <dbl>     <dbl>     <dbl>\n#> 1 Afghanistan  1980       NA        NA        NA        NA        NA\n#> 2 Afghanistan  1981       NA        NA        NA        NA        NA\n#> 3 Afghanistan  1982       NA        NA        NA        NA        NA\n#> 4 Afghanistan  1983       NA        NA        NA        NA        NA\n#> 5 Afghanistan  1984       NA        NA        NA        NA        NA\n#> 6 Afghanistan  1985       NA        NA        NA        NA        NA\n#> # ℹ 7,234 more rows\n#> # ℹ 51 more variables: sp_m_5564 <dbl>, sp_m_65 <dbl>, sp_f_014 <dbl>, …\n```\n:::\n\n\nSo in this case we have six pieces of information recorded in who2: the country and the year (already columns); the method of diagnosis, the gender category, and the age range category (contained in the other column names); and the count of patients in that category (cell values). \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwho2 |> \n  pivot_longer(\n    cols = !(country:year),\n    names_to = c(\"diagnosis\", \"gender\", \"age\"), \n    names_sep = \"_\",\n    values_to = \"count\"\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 405,440 × 6\n   country      year diagnosis gender age   count\n   <chr>       <dbl> <chr>     <chr>  <chr> <dbl>\n 1 Afghanistan  1980 sp        m      014      NA\n 2 Afghanistan  1980 sp        m      1524     NA\n 3 Afghanistan  1980 sp        m      2534     NA\n 4 Afghanistan  1980 sp        m      3544     NA\n 5 Afghanistan  1980 sp        m      4554     NA\n 6 Afghanistan  1980 sp        m      5564     NA\n 7 Afghanistan  1980 sp        m      65       NA\n 8 Afghanistan  1980 sp        f      014      NA\n 9 Afghanistan  1980 sp        f      1524     NA\n10 Afghanistan  1980 sp        f      2534     NA\n# ℹ 405,430 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 405,440 × 6\n#>   country      year diagnosis gender age   count\n#>   <chr>       <dbl> <chr>     <chr>  <chr> <dbl>\n#> 1 Afghanistan  1980 sp        m      014      NA\n#> 2 Afghanistan  1980 sp        m      1524     NA\n#> 3 Afghanistan  1980 sp        m      2534     NA\n#> 4 Afghanistan  1980 sp        m      3544     NA\n#> 5 Afghanistan  1980 sp        m      4554     NA\n#> 6 Afghanistan  1980 sp        m      5564     NA\n#> # ℹ 405,434 more rows\n```\n:::\n\n\nWhat if the column names include a mix of of variable values and variable names?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhousehold\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 5\n  family dob_child1 dob_child2 name_child1 name_child2\n   <int> <date>     <date>     <chr>       <chr>      \n1      1 1998-11-26 2000-01-29 Susan       Jose       \n2      2 1996-06-22 NA         Mark        <NA>       \n3      3 2002-07-11 2004-04-05 Sam         Seth       \n4      4 2004-10-10 2009-08-27 Craig       Khai       \n5      5 2000-12-05 2005-02-28 Parker      Gracie     \n```\n\n\n:::\n:::\n\n\nUse the `.value` sentinel value to indicate the first component of the pivoted column name as a variable name in the output. Note the lack of a `values_to` argument here. When you use `.value` in `names_to`, the column names in the input contribute to both values and variable names in the output.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhousehold |> \n  pivot_longer(\n    cols = !family, \n    names_to = c(\".value\", \"child\"), \n    names_sep = \"_\", \n    values_drop_na = TRUE\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 9 × 4\n  family child  dob        name  \n   <int> <chr>  <date>     <chr> \n1      1 child1 1998-11-26 Susan \n2      1 child2 2000-01-29 Jose  \n3      2 child1 1996-06-22 Mark  \n4      3 child1 2002-07-11 Sam   \n5      3 child2 2004-04-05 Seth  \n6      4 child1 2004-10-10 Craig \n7      4 child2 2009-08-27 Khai  \n8      5 child1 2000-12-05 Parker\n9      5 child2 2005-02-28 Gracie\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 9 × 4\n#>   family child  dob        name \n#>    <int> <chr>  <date>     <chr>\n#> 1      1 child1 1998-11-26 Susan\n#> 2      1 child2 2000-01-29 Jose \n#> 3      2 child1 1996-06-22 Mark \n#> 4      3 child1 2002-07-11 Sam  \n#> 5      3 child2 2004-04-05 Seth \n#> 6      4 child1 2004-10-10 Craig\n#> # ℹ 3 more rows\n```\n:::\n\n\n\n\n## 5.4 Widening data\n\nUse `pivot_wider()` to increase columns and reduce rows.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncms_patient_experience |> \n  distinct(measure_cd, measure_title)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 2\n  measure_cd   measure_title                                                    \n  <chr>        <chr>                                                            \n1 CAHPS_GRP_1  CAHPS for MIPS SSM: Getting Timely Care, Appointments, and Infor…\n2 CAHPS_GRP_2  CAHPS for MIPS SSM: How Well Providers Communicate               \n3 CAHPS_GRP_3  CAHPS for MIPS SSM: Patient's Rating of Provider                 \n4 CAHPS_GRP_5  CAHPS for MIPS SSM: Health Promotion and Education               \n5 CAHPS_GRP_8  CAHPS for MIPS SSM: Courteous and Helpful Office Staff           \n6 CAHPS_GRP_12 CAHPS for MIPS SSM: Stewardship of Patient Resources             \n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 6 × 2\n#>   measure_cd   measure_title                                                 \n#>   <chr>        <chr>                                                         \n#> 1 CAHPS_GRP_1  CAHPS for MIPS SSM: Getting Timely Care, Appointments, and In…\n#> 2 CAHPS_GRP_2  CAHPS for MIPS SSM: How Well Providers Communicate            \n#> 3 CAHPS_GRP_3  CAHPS for MIPS SSM: Patient's Rating of Provider              \n#> 4 CAHPS_GRP_5  CAHPS for MIPS SSM: Health Promotion and Education            \n#> 5 CAHPS_GRP_8  CAHPS for MIPS SSM: Courteous and Helpful Office Staff        \n#> 6 CAHPS_GRP_12 CAHPS for MIPS SSM: Stewardship of Patient Resources\n```\n:::\n\n\n\n`pivot_wider()` has the opposite interface to `pivot_longer()`: instead of choosing new column names, we need to provide the existing columns that define the values (`values_from`) and the column name (`names_from`):\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncms_patient_experience |> \n  pivot_wider(\n    names_from = measure_cd,\n    values_from = prf_rate\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 500 × 9\n   org_pac_id org_nm           measure_title CAHPS_GRP_1 CAHPS_GRP_2 CAHPS_GRP_3\n   <chr>      <chr>            <chr>               <dbl>       <dbl>       <dbl>\n 1 0446157747 USC CARE MEDICA… CAHPS for MI…          63          NA          NA\n 2 0446157747 USC CARE MEDICA… CAHPS for MI…          NA          87          NA\n 3 0446157747 USC CARE MEDICA… CAHPS for MI…          NA          NA          86\n 4 0446157747 USC CARE MEDICA… CAHPS for MI…          NA          NA          NA\n 5 0446157747 USC CARE MEDICA… CAHPS for MI…          NA          NA          NA\n 6 0446157747 USC CARE MEDICA… CAHPS for MI…          NA          NA          NA\n 7 0446162697 ASSOCIATION OF … CAHPS for MI…          59          NA          NA\n 8 0446162697 ASSOCIATION OF … CAHPS for MI…          NA          85          NA\n 9 0446162697 ASSOCIATION OF … CAHPS for MI…          NA          NA          83\n10 0446162697 ASSOCIATION OF … CAHPS for MI…          NA          NA          NA\n# ℹ 490 more rows\n# ℹ 3 more variables: CAHPS_GRP_5 <dbl>, CAHPS_GRP_8 <dbl>, CAHPS_GRP_12 <dbl>\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 500 × 9\n#>   org_pac_id org_nm                   measure_title   CAHPS_GRP_1 CAHPS_GRP_2\n#>   <chr>      <chr>                    <chr>                 <dbl>       <dbl>\n#> 1 0446157747 USC CARE MEDICAL GROUP … CAHPS for MIPS…          63          NA\n#> 2 0446157747 USC CARE MEDICAL GROUP … CAHPS for MIPS…          NA          87\n#> 3 0446157747 USC CARE MEDICAL GROUP … CAHPS for MIPS…          NA          NA\n#> 4 0446157747 USC CARE MEDICAL GROUP … CAHPS for MIPS…          NA          NA\n#> 5 0446157747 USC CARE MEDICAL GROUP … CAHPS for MIPS…          NA          NA\n#> 6 0446157747 USC CARE MEDICAL GROUP … CAHPS for MIPS…          NA          NA\n#> # ℹ 494 more rows\n#> # ℹ 4 more variables: CAHPS_GRP_3 <dbl>, CAHPS_GRP_5 <dbl>, …\n```\n:::\n\n\nIf you still have multiple rows per unit of interest, organization in this case, then the `pivot_wider()` didn't work.\n\nThe problem is we need to tell `pivot_wider()` which column or columns have values that uniquely identify each row, in this case those are the variables starting with `\"org\"`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncms_patient_experience |> \n  pivot_wider(\n    id_cols = starts_with(\"org\"),\n    names_from = measure_cd,\n    values_from = prf_rate\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 95 × 8\n   org_pac_id org_nm CAHPS_GRP_1 CAHPS_GRP_2 CAHPS_GRP_3 CAHPS_GRP_5 CAHPS_GRP_8\n   <chr>      <chr>        <dbl>       <dbl>       <dbl>       <dbl>       <dbl>\n 1 0446157747 USC C…          63          87          86          57          85\n 2 0446162697 ASSOC…          59          85          83          63          88\n 3 0547164295 BEAVE…          49          NA          75          44          73\n 4 0749333730 CAPE …          67          84          85          65          82\n 5 0840104360 ALLIA…          66          87          87          64          87\n 6 0840109864 REX H…          73          87          84          67          91\n 7 0840513552 SCL H…          58          83          76          58          78\n 8 0941545784 GRITM…          46          86          81          54          NA\n 9 1052612785 COMMU…          65          84          80          58          87\n10 1254237779 OUR L…          61          NA          NA          65          NA\n# ℹ 85 more rows\n# ℹ 1 more variable: CAHPS_GRP_12 <dbl>\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 95 × 8\n#>   org_pac_id org_nm           CAHPS_GRP_1 CAHPS_GRP_2 CAHPS_GRP_3 CAHPS_GRP_5\n#>   <chr>      <chr>                  <dbl>       <dbl>       <dbl>       <dbl>\n#> 1 0446157747 USC CARE MEDICA…          63          87          86          57\n#> 2 0446162697 ASSOCIATION OF …          59          85          83          63\n#> 3 0547164295 BEAVER MEDICAL …          49          NA          75          44\n#> 4 0749333730 CAPE PHYSICIANS…          67          84          85          65\n#> 5 0840104360 ALLIANCE PHYSIC…          66          87          87          64\n#> 6 0840109864 REX HOSPITAL INC          73          87          84          67\n#> # ℹ 89 more rows\n#> # ℹ 2 more variables: CAHPS_GRP_8 <dbl>, CAHPS_GRP_12 <dbl>\n```\n:::\n\n\n\nHow does `pivot_wider()` work?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- tribble(\n  ~id, ~measurement, ~value,\n  \"A\",        \"bp1\",    100,\n  \"B\",        \"bp1\",    140,\n  \"B\",        \"bp2\",    115, \n  \"A\",        \"bp2\",    120,\n  \"A\",        \"bp3\",    105\n)\n```\n:::\n\n\nTake the values from the `value` column and the column names from the `measurement` column.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf |> \n  pivot_wider(\n    names_from = measurement,\n    values_from = value\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 4\n  id      bp1   bp2   bp3\n  <chr> <dbl> <dbl> <dbl>\n1 A       100   120   105\n2 B       140   115    NA\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 2 × 4\n#>   id      bp1   bp2   bp3\n#>   <chr> <dbl> <dbl> <dbl>\n#> 1 A       100   120   105\n#> 2 B       140   115    NA\n```\n:::\n\n\nAny column that does not go into the `names_from` or `values_from` argument determines the number of rows. These are called the `id_cols`.\n\nWhat if we have duplicate values in the column giving the new column names and in the column giving the new value names? We get list-columns.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- tribble(\n  ~id, ~measurement, ~value,\n  \"A\",        \"bp1\",    100,\n  \"A\",        \"bp1\",    102,\n  \"A\",        \"bp2\",    120,\n  \"B\",        \"bp1\",    140, \n  \"B\",        \"bp2\",    115\n)\n\n\ndf |>\n  pivot_wider(\n    names_from = measurement,\n    values_from = value\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Values from `value` are not uniquely identified; output will contain list-cols.\n• Use `values_fn = list` to suppress this warning.\n• Use `values_fn = {summary_fun}` to summarise duplicates.\n• Use the following dplyr code to identify duplicates.\n  {data} |>\n  dplyr::summarise(n = dplyr::n(), .by = c(id, measurement)) |>\n  dplyr::filter(n > 1L)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n  id    bp1       bp2      \n  <chr> <list>    <list>   \n1 A     <dbl [2]> <dbl [1]>\n2 B     <dbl [1]> <dbl [1]>\n```\n\n\n:::\n\n```{.r .cell-code}\n#> Warning: Values from `value` are not uniquely identified; output will contain\n#> list-cols.\n#> • Use `values_fn = list` to suppress this warning.\n#> • Use `values_fn = {summary_fun}` to summarise duplicates.\n#> • Use the following dplyr code to identify duplicates.\n#>   {data} |>\n#>   dplyr::summarise(n = dplyr::n(), .by = c(id, measurement)) |>\n#>   dplyr::filter(n > 1L)\n#> # A tibble: 2 × 3\n#>   id    bp1       bp2      \n#>   <chr> <list>    <list>   \n#> 1 A     <dbl [2]> <dbl [1]>\n#> 2 B     <dbl [1]> <dbl [1]>\n```\n:::\n\n\nFollow the hint in the warning to locate the duplicate:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf |> \n  group_by(id, measurement) |> \n  summarize(n = n(), .groups = \"drop\") |> \n  filter(n > 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n  id    measurement     n\n  <chr> <chr>       <int>\n1 A     bp1             2\n```\n\n\n:::\n\n```{.r .cell-code}\n#> # A tibble: 1 × 3\n#>   id    measurement     n\n#>   <chr> <chr>       <int>\n#> 1 A     bp1             2\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 3\n  id    measurement value\n  <chr> <chr>       <dbl>\n1 A     bp1           100\n2 A     bp1           102\n3 A     bp2           120\n4 B     bp1           140\n5 B     bp2           115\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}