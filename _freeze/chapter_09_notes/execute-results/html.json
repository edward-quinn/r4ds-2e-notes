{
  "hash": "ff9bb92ff29266c87ea20375a1abfec0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R for Data Science, 2nd Edition - Chapter 9 Notes\"\nfreeze: true\nformat:\n    html:\n        toc: true\neditor_options: \n  chunk_output_type: console\n---\n\n# 9 Layers\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.6\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.2\n✔ purrr     1.2.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n:::\n\n\n## 9.2 Aesthetic mappings\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Left\nggplot(mpg, aes(x = displ, y = hwy, color = class)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Right\nggplot(mpg, aes(x = displ, y = hwy, shape = class)) +\n  geom_point()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The shape palette can deal with a maximum of 6 discrete values because more\nthan 6 becomes difficult to discriminate\nℹ you have requested 7 values. Consider specifying shapes manually if you need\n  that many of them.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 62 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n\n```{.r .cell-code}\n#> Warning: The shape palette can deal with a maximum of 6 discrete values because more\n#> than 6 becomes difficult to discriminate\n#> ℹ you have requested 7 values. Consider specifying shapes manually if you\n#>   need that many of them.\n#> Warning: Removed 62 rows containing missing values or values outside the scale range\n#> (`geom_point()`).\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Left\nggplot(mpg, aes(x = displ, y = hwy, size = class)) +\n  geom_point()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using size for a discrete variable is not advised.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#> Warning: Using size for a discrete variable is not advised.\n\n# Right\nggplot(mpg, aes(x = displ, y = hwy, alpha = class)) +\n  geom_point()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using alpha for a discrete variable is not advised.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n```{.r .cell-code}\n#> Warning: Using alpha for a discrete variable is not advised.\n```\n:::\n\n\nArguments outside of `aes()` do not map onto variables to determine appearance.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = displ, y = hwy)) + \n  geom_point(color = \"blue\")\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n## 9.3 Geometric objects\n\n\nSame data, different geoms:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Left\nggplot(mpg, aes(x = displ, y = hwy)) + \n  geom_point()\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Right\nggplot(mpg, aes(x = displ, y = hwy)) + \n  geom_smooth()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n\n```{.r .cell-code}\n#> `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n:::\n\n\nNot every aesthetic works with every geom. You can't set the `shape` or a line geom.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Left\nggplot(mpg, aes(x = displ, y = hwy, shape = drv)) + \n  geom_smooth()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Right\nggplot(mpg, aes(x = displ, y = hwy, linetype = drv)) + \n  geom_smooth()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n\n\nInstead of giving a shape to a line geom, ggplot split the lines by `drv`.\n\nFor geoms that produce a single geometric object, you can use the `group` aesthetic to draw multiple objects. Note that the `group` aesthetic does not add a legend or distinguishing features to the geoms.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = displ, y = hwy, color = drv)) + \n  geom_point() +\n  geom_smooth(aes(linetype = drv))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nPlacing mappings in a geom function overwrites the global mappings for that layer only. This means you can have different aesthetics in different layers.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = displ, y = hwy)) + \n  geom_point(aes(color = class)) + \n  geom_smooth()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nYou can use this idea to specify different data for each layer.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = displ, y = hwy)) + \n  geom_point() + \n  geom_point(\n    data = mpg |> filter(class == \"2seater\"), \n    color = \"red\"\n  ) +\n  geom_point(\n    data = mpg |> filter(class == \"2seater\"), \n    shape = \"circle open\", size = 3, color = \"red\"\n  )\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Left\nggplot(mpg, aes(x = hwy)) +\n  geom_histogram(binwidth = 2)\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Middle\nggplot(mpg, aes(x = hwy)) +\n  geom_density()\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-10-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# Right\nggplot(mpg, aes(x = hwy)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-10-3.png){width=672}\n:::\n:::\n\n\n\n\n## 9.4 Facets\n\n\n`facet_wrap()` splits a plot into subplots that each display one subset of the data based on a categorical variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = displ, y = hwy)) + \n  geom_point() + \n  facet_wrap(~cyl)\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\nTo facet with a combination of two variables, switch to `facet_grid()`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = displ, y = hwy)) + \n  geom_point() + \n  facet_grid(drv ~ cyl)\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\nLet the x and y axes vary across plots with `scales = \"free\"`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = displ, y = hwy)) + \n  geom_point() + \n  facet_grid(drv ~ cyl, scales = \"free\")\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nUse the `.` to facet horizontally?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg) + \n  geom_point(aes(x = displ, y = hwy)) +\n  facet_grid(drv ~ .)\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = displ)) + \n  geom_histogram() + \n  facet_grid(drv ~ .)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(mpg, aes(x = displ)) + \n  geom_histogram() + \n  facet_wrap(~drv)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-15-2.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(mpg, aes(x = displ)) + \n  geom_histogram() +\n  facet_grid(. ~ drv)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-15-3.png){width=672}\n:::\n:::\n\n\n\n\n## 9.5 Statistical transformations\n\nWhen new values have to be calculated for the plot.\n\n-   Bar charts, histograms, and frequency polygons bin your data and then plot bin counts, the number of points that fall in each bin.\n\n-   Smoothers fit a model to your data and then plot predictions from the model.\n\n-   Boxplots compute the five-number summary of the distribution and then display that summary as a specially formatted box.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diamonds, aes(x = cut)) + \n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\nThe algorithm used to calculate new values for a graph is called a **stat**, short for statistical transformation.\n\nYou can see which stat a geom uses by looking at default arguments, and the documentation for a given stat can be found on the geom help page. See how `stat_count()` is documented on the `geom_bar()` help page.\n\nEvery geom has a default stat, and every stat has a default geom.\n\nYou might need to use the stat explicitly to:\n\n1. override the default stat\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiamonds |>\n  count(cut) |>\n  ggplot(aes(x = cut, y = n)) +\n  geom_bar(stat = \"identity\")\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n2. Override default mapping from transformed variables to aesthetics.\n\nFor example, a bar chart of proportions instead of counts is possible like this:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diamonds, aes(x = cut, y = after_stat(prop), group = 1)) + \n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n3. You might want to draw greater attention to the statistical transformation in your code. Here is an example with `stat_summary()`, which summarizes the `y` value for each unique `x` value plotted.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(diamonds) + \n  stat_summary(\n    aes(x = cut, y = depth),\n    fun.min = min,\n    fun.max = max,\n    fun = median\n  )\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n\n\n## 9.6 Position adjustments\n\nYou can add color to the edges or the fill like so:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Left\nggplot(mpg, aes(x = drv, color = drv)) + \n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Right\nggplot(mpg, aes(x = drv, fill = drv)) + \n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-20-2.png){width=672}\n:::\n:::\n\n\n\nMapping the `fill` aesthetic to another variable results in automatic stacking of bar charts.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = drv, fill = class)) + \n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n\nThis automatic stacking is accomplished with **position adjustment** using the `position` argument. If you don't want a stacked bar chart, you can use one of three other options: `\"identity\"`, `\"dodge\"`, or `\"fill\"`.\n\n`\"identity\"` will place each object exactly where it falls in the context of the graph.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Left\nggplot(mpg, aes(x = drv, fill = class)) + \n  geom_bar(alpha = 1/5, position = \"identity\")\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Right\nggplot(mpg, aes(x = drv, color = class)) + \n  geom_bar(fill = NA, position = \"identity\")\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-22-2.png){width=672}\n:::\n:::\n\n\n\n`position = \"fill\"` works like stacking, but makes each bar the same height. Easier to compare proportions.\n\n`position = \"dodge\"` places overlapping objects directly *beside* one another.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Left\nggplot(mpg, aes(x = drv, fill = class)) + \n  geom_bar(position = \"fill\")\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Right\nggplot(mpg, aes(x = drv, fill = class)) + \n  geom_bar(position = \"dodge\")\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-23-2.png){width=672}\n:::\n:::\n\n\n\nWhat about **overplotting**? Use `position = \"jitter\"`. This is most useful with a scatter plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mpg, aes(x = displ, y = hwy)) + \n  geom_point(position = \"jitter\")\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n\n\n## 9.7 Coordinate systems\n\n\nMaps. `coord_quickmap()` sets the aspect ratio for maps.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnz <- map_data(\"nz\")\n\nggplot(nz, aes(x = long, y = lat, group = group)) +\n  geom_polygon(fill = \"white\", color = \"black\")\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(nz, aes(x = long, y = lat, group = group)) +\n  geom_polygon(fill = \"white\", color = \"black\") +\n  coord_quickmap()\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-25-2.png){width=672}\n:::\n:::\n\n\n`coord_polar()` uses polar coordinates. Polar coordinates reveal an interesting connection between a bar chart and a Coxcomb chart.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbar <- ggplot(data = diamonds) + \n  geom_bar(\n    mapping = aes(x = clarity, fill = clarity), \n    show.legend = FALSE,\n    width = 1\n  ) + \n  theme(aspect.ratio = 1)\n\nbar + coord_flip()\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n\n```{.r .cell-code}\nbar + coord_polar()\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-26-2.png){width=672}\n:::\n:::\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = mpg, mapping = aes(x = cty, y = hwy)) +\n  geom_point() + \n  geom_abline() +\n  coord_fixed()\n```\n\n::: {.cell-output-display}\n![](chapter_09_notes_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## 9.8 The layered grammar of graphics\n\n\nggplot(data = <DATA>) + \n  <GEOM_FUNCTION>(\n     mapping = aes(<MAPPINGS>),\n     stat = <STAT>, \n     position = <POSITION>\n  ) +\n  <COORDINATE_FUNCTION> +\n  <FACET_FUNCTION>\n",
    "supporting": [
      "chapter_09_notes_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}